<html>
	<head>
		<link rel="stylesheet" type = "text/css" href="leaflet/leaflet.css" />
   		<script src = "leaflet/leaflet.js"></script>
   		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.13.min.js"></script>
		<script type="text/javascript" src="jquery-1.9.1.js"></script>
		<script type="text/javascript" src="jquery-ui-1.10.3.custom.js"></script>
		<script type="text/javascript" src="jquery.dataTables.js"></script>

   		<!--This defines some basic styles associated with the map and .info-->
   		<link rel="stylesheet" type="text/css" href="style.css">
   		</style>
	</head>
	<body>
		<div class = "nav-bar" id="title"><b> <p style="text-align:left;">Arctic Virtual Forum<span style="float:right;">Log In</span></p></b></div>
		<div class = "header" id = "header-bar">
			<img class = "header" id = "header-image" src="arctic-pic.jpg">
		</div>
		<div id="control">
			<img id = "arctic-map" src="arctic-map3.gif">
			<div id = "reports-control" > <div class = "vertical"> <b> Reports </b> </div></div>
			<div id = "conferences-control" ><div class = "vertical"> <b> Conferences </b> </div></div>
			<div id = "about-control"><div class = "vertical"> <b> About </b> </div> </div>
			<div id = "websites-control"><div class = "vertical"> <b> Websites </b> </div> </div>
		</div>
		<div id="map">
		</div>
		<div id = "about-arctic">
			 	<b>
				The Arctic (/ˈɑrktɪk/ or /ˈɑrtɪk/) is a polar region located at the northernmost part of the Earth. The Arctic consists of the Arctic Ocean and parts of Canada, Russia, the United States (Alaska), Denmark (Greenland), Norway, Sweden, Finland, and Iceland. The Arctic region consists of a vast, ice-covered ocean, surrounded by treeless permafrost. The area can be defined as north of the Arctic Circle (66° 33'N), the approximate limit of the midnight sun and the polar night. Alternatively, it can be defined as the region where the average temperature for the warmest month (July) is below 10 °C (50 °F); the northernmost tree line roughly follows the isotherm at the boundary of this region.[1][2]
				Socially and politically, the Arctic region includes the northern territories of the eight Arctic states, although by natural science definitions much of this territory is considered subarctic. The Arctic region is a unique area among Earth's ecosystems. The cultures in the region and the Arctic indigenous peoples have adapted to its cold and extreme conditions. In recent years the extent of the sea ice has declined.[3][4] Life in the Arctic includes organisms living in the ice,[5] zooplankton and phytoplankton, fish and marine mammals, birds, land animals, plants and human societies. 
				</b>
		</div>
		<div id = "websites-arctic">
			 	<b>
				<a href = "http://iacp.dartmouth.edu/">http://iacp.dartmouth.edu/</a><br>
				<a href = "http://www.uarctic.org">http://www.uarctic.org</a><br>
				<a href = "http://www.iasc.info">http://www.iasc.info</a><br>
				
		</div>
		<!-- GeoJSON Data (countries-hires.js) -->
		<script type="text/javascript" src="countries-hires.js"></script>
		<script type="text/javascript" src="reports.js"></script>

		<!-- Our javascript code-->
		<script type="text/javascript">
			Parse.initialize("g9E0CvsnPFgymkq8FxTN0khh9FZ5sqbaqsoN6GfH", "R83Wi2r7ndSyA3gFUDqk6f3tZ9RP1Sn7WO3L9q3G");

			var points_list = [];
			var cloudmadeUrl = 'http://{s}.tile.cloudmade.com/e2c7205a90f64eec9d06b4f89e44ce0c/111453/256/{z}/{x}/{y}.png',
            cloudmadeAttribution = 'Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade';
			var normal = L.tileLayer(cloudmadeUrl, {
			    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, <img src="url" alt="some_text">Imagery © <a href="http://cloudmade.com">CloudMade</a>',
			    maxZoom: 18
			})// add a tile

			var info = L.control();
	
			info.onAdd = function (map) {
				this._div = L.DomUtil.create('div', 'info');
				this.update();
				return this._div;
			};
	
			info.update = function (props) {
				this._div.innerHTML = '<h4>World</h4>' +  (props ?
					'<b>' + props.NAME + '</b><br />'
					+ 'Reports'
					: 'Hover over a country');
			};
	
			function getColor(c) {
    			return c == 6  ? '#800026' :
			           c == 5  ? '#BD0026' :
			           c == 4  ? '#E31A1C' :
			           c == 3  ? '#FC4E2A' :
			           c == 2  ? '#FD8D3C' :
			           c == 1  ? '#FEB24C' :
			           c == 0  ? '#FED976' :
			                      '#FFEDA0';
			}

			function style(feature) {
			    return {
			        fillColor: getColor(feature.properties.MAP_COLOR),
			        weight: 2,
			        opacity: 1,
			        color: 'white',
			        dashArray: '3',
			        fillOpacity: 0.7
			    };
			}
			
			// Variables to hold the GeoJSON data for the countries and reports respectively
			var countries;
			var reports;

			// Function that will highlight a feature that is passed to it
			function highlightFeature(e) {
			    var layer = e.target;
			
			    layer.setStyle({
			        weight: 5,
			        color: '#666',
			        dashArray: '',
			        fillOpacity: 0.7
			    });
			
			    if (!L.Browser.ie && !L.Browser.opera) {
			        layer.bringToFront();
			    }
			    info.update(layer.feature.properties);
			}
			
			// Resets the highlight
			function resetHighlight(e) {
			    countries.resetStyle(e.target);
			    info.update();
			}
			
			// Acquires the bounds of a feature e and zooms in on them
			function zoomToFeature(e) {
				map.fitBounds(e.target.getBounds());
			}
			
			// Takes a feature and a layer and highlights the feature while mouse is on it
			// Also zooms on to the feature when the feature is clicked
			function onEachFeature(feature, layer) {
				layer.on({
					mouseover: highlightFeature,
					mouseout: resetHighlight,
					click: zoomToFeature
				});
			}


			// Adding in an icon
			var blackIcon = L.icon({
				iconUrl: 'black-dot.png',
			    iconSize:     [6, 6], // size of the icon
			    shadowSize:   [0, 0], // size of the shadow
			    iconAnchor:   [3, 3], // point of the icon which will correspond to marker's location
			    shadowAnchor: [4, 62],  // the same for the shadow
			    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
			});

			function onEachFeature(feature, layer) {
				if (feature.properties && feature.properties.name) {
					layer.bindPopup(feature.properties.name)
				}
			}

			// Creating a geoJSON layer for the country data with highlight and zoom capabilities
			countries = L.geoJson(countryData, {
				style: style,
				onEachFeature: onEachFeature
			});


			/* Creating a geoJSON layer for the report data with custom icon.
			Has highlight and zoom capabilities. */
			reports = L.geoJson(null, {
				style: style,
				pointToLayer: function(feature, latlng) {
					return L.marker(latlng); //, {icon: blackIcon});
				},
				onEachFeature: onEachFeature
			});

			reports.addData(pointsData);

			conferences = L.geoJson(null, {
				pointToLayer: function(feature, latlng) {
					return new L.Marker(latlng)
				},
				onEachFeature: onEachFeature
			});

			function toggleLayer(map, layer){
				if (map.hasLayer(layer))
					map.removeLayer(layer);
				else
					map.addLayer(layer);
			}

			var Conference = Parse.Object.extend("Conference");
    		var query = new Parse.Query(Conference);
		    function getAllConferences() {
		    	query.find({
			      success: function(results) {

			        // Do something with the returned Parse.Object values
			        for (var i = 0; i < results.length; i++) {
			        	var name = results[i].get('name');
			        	var latitude = results[i].get('latitude');
			        	var longitude = results[i].get('longitude');
			        	var point = {
			        		"type": "Feature",
			        		"idreports": i,
			        		"geometry": {
			        			"type": "Point",
			        			"coordinates": [latitude, longitude]
			        		},
			        		"properties": {
			        			"name": name,
			        			"LATITUDE": latitude,
			        			"LONGITUDE": longitude
			        		}
			        		
			        	};	
			        	conferences.addData(point);		        	
			        }
			        
			      },

			      error: function(error) {}
				});
		    }

		    getAllConferences();

		    
			// Initialize the map with center location and zoom level.
			var map = L.map('map', {
				center: new L.LatLng(66, 0),
                zoom: 2,
                maxZoom: 8,
                minZoom: 0,
				layers: [normal, countries]
			});

			map.setView(new L.LatLng(54.6, -3), 2)

			var geojsonMarkerOptions = {
				radius: 60,
				fillColor: "#ff7800",
				color: "#000",
				weight: 1,
				opacity: 5,
				fillOpacity: .8
			};
			// Add info control to the map
			info.addTo(map);

			var baseMaps = {
            	"Normal": normal
            };
        
            var overlayMaps = {
            	"countries": countries,
            	"reports": reports,
            	"conferences": conferences
            };
            $( document ).ready(function() {
    			$( "#reports-control" ).click(function(){
    				toggleLayer(map, reports);
    			});
    			$( "#conferences-control" ).click(function(){
    				toggleLayer(map, conferences);
    			});
    			$( "#about-control" ).click(function(){
    				$('#about-arctic').toggle();
    			});
    			$( "#websites-control" ).click(function(){
    				$('#websites-arctic').toggle();
    			});

			});


			// Events

			// Add a layer controller to the map
			//L.control.layers(baseMaps, overlayMaps).addTo(map);
			
			// When the map is clicked, initialize an icon
			function onMapClick(e) {
				var maker = L.marker(e.latlng, {icon: blackIcon}).addTo(map);

				/*// Draw two points
				points_list.push(e.latlng);
				if(points_list.length % 2 == 1){
					//draw nothing
				}else{
					//draw a line
					var latlngs = [];
					latlngs.push(e.latlng);
					points_list.pop();
					latlngs.push(points_list.pop());
					// create a red polyline from an arrays of LatLng points
					var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);
					
					// zoom the map to the polyline
					//map.fitBounds(polyline.getBounds());
					
					
					//draw curves
					
				}*/
			}

			map.on('click', onMapClick);
		</script>
	</body>
</html>